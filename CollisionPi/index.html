<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            background-color: #5502DB;
        }



        canvas {
            border: 1px dotted black;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <h1 id="counter">0</h1>
        <p>Mit welchem Exponenten soll die Masse vergrößert werden</p>
        <h1>Exponent</h1>
        <input type="number" id="PowSlider">
        <h1>Timestep</h1>
        <p>Wie Präzise soll es berechnet werden</p>
        <input type="number" id="TsSlider">
        <button onclick="restart(left, right)">Restart</button>
        <canvas></canvas>
        <script>
            window.addEventListener('resize', function () {
                canvas.width = innerWidth;
                canvas.height = 400
            })


            const canvas = document.querySelector("canvas")
            const ctx = canvas.getContext('2d')
            canvas.width = innerWidth;
            canvas.height = 400

            const counter = document.getElementById('counter')



            class Block {
                constructor(x, velocity, size, mass, color) {
                    this.x = x;
                    this.y = 100
                    this.v = velocity
                    this.size = size;
                    this.mass = mass

                    this.color = color;
                }

                update() {
                    this.x += this.v
                }

                collide(other) {
                    if (this.x + this.size < other.x || this.x > other.x + other.size) {
                        return true;
                    }
                    return false;
                }
                bounce(other) {
                    let sumM = this.mass + other.mass
                    let newV = (this.mass - other.mass) / sumM * this.v
                    newV += (2 * other.mass / sumM) * other.v
                    return newV
                }
                draw() {
                    ctx.beginPath();
                    ctx.rect(this.x, this.y, this.size, this.size);
                    ctx.fillStyle = this.color
                    ctx.fill()
                    ctx.closePath();
                }


            }

            const restart = (block, block2) => {
                block2.mass = Math.pow(document.getElementById('PowSlider').value, 2)

                TimeSteps = document.getElementById('TsSlider').value
                block.x = 10
                block.v = 0
                block2.x = 100
                block2.v = -1 / TimeSteps

                count = 0
                counter.innerHTML = 0

            }

            let count = 0;
            //Timesteps calculate the position more often to get better results
            //Euler integration

            //Set time step to 100 and right.mass to the digitcount after the comma u want
            let TimeSteps = 10

            let left = new Block()
            left.x = 10
            left.v = 0
            left.size = 40
            left.mass = 1
            left.color = "red"

            let right = new Block()
            right.x = 100
            right.v = -1 / TimeSteps
            right.size = 100
            right.mass = Math.pow(100, 2)
            right.color = "blue"



            const animate = () => {
                requestAnimationFrame(animate)

                //clear
                ctx.clearRect(0, 0, canvas.width, canvas.height)

                for (let i = 0; i < TimeSteps; i++) {

                    if (!left.collide(right)) {
                        count++
                        counter.innerHTML = count
                        const v1 = left.bounce(right)
                        const v2 = right.bounce(left)

                        left.v = v1
                        right.v = v2
                    }

                    if (left.x <= 0) {
                        left.v = -left.v
                        count++
                        counter.innerHTML = count

                    }


                    left.update()
                    right.update()
                }

                left.draw();
                right.draw();

            }

            animate();
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8"
            crossorigin="anonymous"></script>
    </div>
</body>

</html>
