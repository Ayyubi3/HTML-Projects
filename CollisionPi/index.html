<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
        }

        h1 {
            margin: 10vw;
        }

        canvas {
            border: 1px dotted black;
        }
    </style>
</head>

<body>
    <h1 id="counter">0</h1>
    <canvas></canvas>
    <script>
        const canvas = document.querySelector("canvas")
        const ctx = canvas.getContext('2d')

        const counter = document.getElementById('counter')

        canvas.width = innerWidth;
        canvas.height = 400

        class Block {
            constructor(x, velocity, size, mass, color) {
                this.x = x;
                this.y = 100
                this.v = velocity
                this.size = size;
                this.mass = mass

                this.color = color;
            }

            update() {
                this.x += this.v
            }

            collide(other) {
                if (this.x + this.size < other.x || this.x > other.x + other.size) {
                    return true;
                }
                return false;
            }
            bounce(other) {
                let sumM = this.mass + other.mass
                let newV = (this.mass - other.mass) / sumM * this.v
                newV += (2 * other.mass / sumM) * other.v
                return newV
            }
            draw() {
                ctx.beginPath();
                ctx.rect(this.x, this.y, this.size, this.size);
                ctx.fillStyle = this.color
                ctx.fill()
                ctx.closePath();
            }


        }

        let count = 0;
        //Timesteps calculate the position more often to get better results
        //Euler integration

        //Set time step to 100 and right.mass to the digitcount after the comma u want
        const TimeSteps = 10

        let left = new Block()
        left.x = 10
        left.v = 0
        left.size = 40
        left.mass = 1
        left.color = "red"

        let right = new Block()
        right.x = 100
        right.v = -1 / TimeSteps
        right.size = 100
        right.mass = Math.pow(100, 2)
        right.color = "blue"



        const animate = () => {
            requestAnimationFrame(animate)

            //clear
            ctx.clearRect(0, 0, canvas.width, canvas.height)

            for (let i = 0; i < TimeSteps; i++) {

                if (!left.collide(right)) {
                    count++
                    counter.innerHTML = count
                    const v1 = left.bounce(right)
                    const v2 = right.bounce(left)

                    left.v = v1
                    right.v = v2
                }

                if (left.x <= 0) {
                    left.v = -left.v
                    count++
                    counter.innerHTML = count

                }


                left.update()
                right.update()
            }

            left.draw();
            right.draw();

        }

        animate();
    </script>
</body>

</html>